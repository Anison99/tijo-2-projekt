<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mój Profil</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

    <script type="text/javascript">
        function updateUserDetail(url, data) {
    $.ajax({
        url: url,
        type: 'PUT', // Zmienione na wielkie litery dla konwencji
        contentType: 'application/json',
        data: JSON.stringify(data),
        success: function (response) {
            console.log('Update success: ', response);
            // Możesz tutaj wyświetlić komunikat o sukcesie lub odświeżyć stronę
            alert("Dane zostały zaktualizowane.");
        },
        error: function() {
            console.log('Error updating user detail.');
            // Możesz wyświetlić błąd
            alert("Wystąpił błąd podczas aktualizacji danych.");
        }
    });
}

$('#change-username-form').submit(function(e) {
    e.preventDefault();
    var newUsername = $('#new-username').val();
    if (newUsername) { // Prosta walidacja po stronie klienta
        updateUserDetail('/api/user/username', { username: newUsername });
    } else {
        alert('Proszę wprowadzić nową nazwę użytkownika.');
    }
});

$('#change-password-form').submit(function(e) {
    e.preventDefault();
    var newPassword = $('#new-password').val();
    if (newPassword) {
        updateUserDetail('/api/user/password', { password: newPassword });
    } else {
        alert('Proszę wprowadzić nowe hasło.');
    }
});

$('#change-email-form').submit(function(e) {
    e.preventDefault();
    var newEmail = $('#new-email').val();
    if (newEmail) {
        updateUserDetail('/api/user/email', { email: newEmail });
    } else {
        alert('Proszę wprowadzić nowy adres e-mail.');
    }
});

$('#delete-account').click(function() {
    if (confirm('Czy na pewno chcesz usunąć swoje konto?')) {
        $.ajax({
            url: '/api/user/delete', // Dodałem '/' na początku URL dla spójności
            type: 'DELETE', // Zmienione na wielkie litery dla konwencji
            success: function (response) {
                console.log('Account deleted: ', response);
                // Przekierowanie na stronę główną lub wylogowanie użytkownika
                window.location.href = 'login.html';
            },
            error: function() {
                console.log('Error deleting account.');
                // Informowanie użytkownika o błędzie
                alert("Wystąpił błąd podczas usuwania konta.");
            }
        });
    }
});
    </script>
</head>
<body>
<object type="text/html" data="navbar.html" width="100%" height="50px"></object>

<div class="container mt-4">
    <h1>Mój Profil</h1>

    <!-- Formularz zmiany nazwy użytkownika -->
    <div class="card my-3">
        <div class="card-body">
            <h4>Zmiana nazwy użytkownika</h4>
            <form id="change-username-form">
                <div class="form-group">
                    <label for="new-username">Nowa nazwa użytkownika:</label>
                    <input type="text" id="new-username" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-primary">Zmień nazwę użytkownika</button>
            </form>
        </div>
    </div>

    <!-- Formularz zmiany hasła -->
    <div class="card my-3">
        <div class="card-body">
            <h4>Zmiana hasła</h4>
            <form id="change-password-form">
                <div class="form-group">
                    <label for="new-password">Nowe hasło:</label>
                    <input type="password" id="new-password" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-primary">Zmień hasło</button>
            </form>
        </div>
    </div>

    <!-- Formularz zmiany adresu email -->
    <div class="card my-3">
        <div class="card-body">
            <h4>Zmiana adresu e-mail</h4>
            <form id="change-email-form">
                <div class="form-group">
                    <label for="new-email">Nowy e-mail:</label>
                    <input type="email" id="new-email" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-primary">Zmień e-mail</button>
            </form>
        </div>
    </div>

    <!-- Przycisk do usunięcia konta -->
    <button class="btn btn-danger" id="delete-account">Usuń konto</button>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
