<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dodaj/Zmień Książkę</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
<object type="text/html" data="navbar.html" width="100%" height="50px"></object>

<div class="container mt-4">
    <h1>Dodaj lub Zmień Książkę</h1>

    <!-- Formularz dodawania książki -->
    <div class="card my-3">
        <div class="card-body">
            <h4>Dodaj nową książkę</h4>
            <form id="add-book-form">
                <div class="form-group">
                    <label for="new-title">Tytuł:</label>
                    <input type="text" id="new-title" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="new-author">Autor:</label>
                    <input type="text" id="new-author" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="new-category">Kategoria:</label>
                    <select id="new-category" class="form-control" required>
                    </select>
                </div>
                <button type="submit" class="btn btn-success">Dodaj książkę</button>
            </form>
        </div>
    </div>

    <div class="card my-3">
        <div class="card-body">
            <h4>Zmień istniejącą książkę</h4>
            <form id="change-book-form">
                <div class="form-group">
                    <label for="book-select">Wybierz książkę:</label>
                    <select id="book-select" class="form-control">
                        <!-- Tutaj zostaną dodane opcje książek -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="edit-title">Nowy tytuł:</label>
                    <input type="text" id="edit-title" class="form-control">
                </div>
                <div class="form-group">
                    <label for="edit-author">Nowy autor:</label>
                    <input type="text" id="edit-author" class="form-control">
                </div>
                <button type="submit" class="btn btn-primary">Zmień dane książki</button>
            </form>
        </div>
    </div>

    <!-- Przycisk usuwania książki -->
    <div>
        <button id="delete-book" class="btn btn-danger">Usuń książkę</button>
    </div>
</div>

<script>
$(document).ready(function() {
    // Ładowanie kategorii
    function loadCategories() {
        $.ajax({
            url: '/api/category', // Endpoint do pobierania kategorii
            type: 'GET',
            success: function(categories) {
                var categorySelect = $('#new-category');
                categorySelect.empty(); // Czyszczenie obecnej zawartości

                categories.forEach(function(category) {
                    categorySelect.append(new Option(category.category_name, category.id));
                });
            },
            error: function() {
                alert("Błąd podczas ładowania kategorii.");
            }
        });
    }
     // Ładowanie listy książek do formularza edycji/usuwania
    function loadBookListForEditing() {
        $.ajax({
            url: '/api/book', // Endpoint do pobierania listy książek
            type: 'GET',
            success: function(books) {
                var bookSelect = $('#book-select');
                bookSelect.empty(); // Czyszczenie obecnej zawartości

                books.forEach(function(book) {
                    bookSelect.append(new Option(book.title, book.id));
                });
            },
            error: function() {
                alert("Błąd podczas ładowania listy książek.");
            }
        });
    }

   // Dodawanie książki
    $('#add-book-form').submit(function(e) {
        e.preventDefault();
        var bookData = {
            title: $('#new-title').val(),
            author: $('#new-author').val(),
            category_id: $('#new-category').val()
        };

        $.ajax({
            url: '/api/book/add', // Endpoint do dodawania książki
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(bookData),
            success: function() {
                alert("Książka została dodana.");
                // Opcjonalnie: odśwież listę książek lub wyczyść formularz
            },
            error: function() {
                alert("Błąd podczas dodawania książki.");
            }
        });
    });

    // Zmiana istniejącej książki
    $('#change-book-form').submit(function(e) {
        e.preventDefault();
        var bookId = $('#book-select').val();
        var updatedData = {
            title: $('#edit-title').val(),
            author: $('#edit-author').val()
            // Opcjonalnie: możesz również dodać zmianę kategorii, jeśli jest wymagana
        };

        $.ajax({
            url: '/api/book/edit/' + bookId, // Endpoint do edycji książki
            type: 'PUT',
            contentType: 'application/json',
            data: JSON.stringify(updatedData),
            success: function() {
                alert("Dane książki zostały zmienione.");
                // Opcjonalnie: odśwież listę książek
            },
            error: function() {
                alert("Błąd podczas zmiany danych książki.");
            }
        });
    });

    // Usuwanie książki
    $('#delete-book').click(function() {
        var bookId = $('#book-select').val(); // Zakładając, że wybrana książka do usunięcia jest ta sama, co w formularzu edycji

        $.ajax({
            url: '/api/book/delete/' + bookId, // Endpoint do usuwania książki
            type: 'DELETE',
            success: function() {
                alert("Książka została usunięta.");
                // Opcjonalnie: odśwież listę książek
            },
            error: function() {
                alert("Błąd podczas usuwania książki.");
            }
        });
    });

    // Inicjalizacja
        loadCategories();
    loadBookListForEditing();});
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
